/*! richtemplate 2017-02-06 */
"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();define("templating/utils/List",[],function(){var List=function(){function List(items){_classCallCheck(this,List),this._map=new Map(items),this._indexes=[].concat(_toConsumableArray(this._map.keys())),this._onDelete=[]}return _createClass(List,[{key:"keys",value:function(){return this._indexes}},{key:"values",value:function(){return this.entries().map(function(entry){return entry[1]})}},{key:"entries",value:function(){var _this=this;return this._indexes.map(function(key){return[key,_this._map.get(key)]})}},{key:"get",value:function(key){return this._map.get(key)}},{key:"forEach",value:function(fn){return this.values().forEach(function(value,index){for(var _len=arguments.length,args=Array(_len>2?_len-2:0),_key=2;_len>_key;_key++)args[_key-2]=arguments[_key];return fn.apply(null,[value,index].concat(args))})}},{key:"getIndex",value:function(key){return this._indexes.indexOf(key)}},{key:"changeIndex",value:function(key,index){if(key){var indexes=this._indexes,indexOf=indexes.indexOf(key);-1!==indexOf&&index!==indexOf&&this._indexes.splice(index,0,this._indexes.splice(indexOf,1)[0])}}},{key:"getValueByIndex",value:function(index){return this._map.get(this._indexes[index])}},{key:"getKeyByIndex",value:function(index){return this._indexes[index]}},{key:"set",value:function(key,value,index){this._map.set(key,value),void 0!==index?this._indexes.splice(index,0,key):this._indexes.push(key)}},{key:"has",value:function(key){return this._map.has(key)}},{key:"clear",value:function(){this._map.clear(),this._indexes.splice(0,this._indexes.length)}},{key:"onDelete",value:function(cb){var chunk=function(){return cb.apply(void 0,arguments)};return this._onDelete.push(chunk),{remove:function(){this._onDelete.splice(this._onDelete.indexOf(chunk,1))}}}},{key:"delete",value:function(key){var _this2=this;this.has(key)&&!function(){var item=_this2._map.get(key);_this2._map["delete"](key),_this2._indexes.splice(_this2._indexes.indexOf(key),1),_this2._onDelete.forEach(function(chunk){return chunk(key,_this2.size,item)})}()}},{key:"deleteByIndex",value:function(index){this["delete"](this._indexes[index])}},{key:"first",get:function(){return this.getValueByIndex(0)}},{key:"last",get:function(){return this.getValueByIndex(this._indexes.length-1)}},{key:"size",get:function(){return this._map.size}}]),List}();return List}),define("templating/dom",[],function(){function isObject(obj){var type="undefined"==typeof obj?"undefined":_typeof(obj);return"function"===type||"object"===type&&!!obj}function createPlaceholder(tag){var placeholder=document.createElement(tag||"div");return placeholder.setAttribute("style","display:none;"),placeholder}function destroy(instance){var keys=Object.keys(instance);keys.length>0&&keys.forEach(function(key){if("root"!==key){var children=instance[key];void 0!==children.elGroup&&children.elGroup.size>0&&children.elGroup.forEach(function(child){void 0!==child&&void 0!==child.remove&&child.remove(!0)})}})}var Element=function(){function Element(el,node){_classCallCheck(this,Element),this.el=el,this._events=[],this.name=node.name||node.data.name;var data=this.data=node.data;data&&data.bind&&(this.bind=data.bind)}return _createClass(Element,[{key:"clone",value:function(){return this.run.apply(this,arguments)}},{key:"text",value:function(_text){dom.text(this,_text)}},{key:"detach",value:function(){dom.detach(this)}},{key:"attach",value:function(){dom.attach(this)}},{key:"changePosition",value:function(index){dom.changePosition(this,index)}},{key:"setAttribute",value:function(prop,value){dom.setAttribute(this,prop,value)}},{key:"getAttribute",value:function(prop){return dom.getAttribute(this,prop)}},{key:"removeAttribute",value:function(prop){dom.removeAttribute(this,prop)}},{key:"setStyle",value:function(prop,value){dom.setStyle(this,prop,value)}},{key:"getStyle",value:function(prop){return dom.getStyle(this,prop)}},{key:"removeStyle",value:function(prop){dom.removeStyle(this,prop)}},{key:"addClass",value:function(className){dom.addClass(this,className)}},{key:"hasClass",value:function(className){return dom.hasClass(this,className)}},{key:"removeClass",value:function(className){dom.removeClass(this,className)}},{key:"val",value:function(_val){return dom.val(this,_val)}},{key:"on",value:function(event,cb,context){var args=Array.prototype.slice.call(arguments,0);return dom.on.apply(!1,[this].concat(args))}},{key:"onDOMAttached",value:function(){return dom.onDOMAttached(this)}},{key:"remove",value:function(force){dom.remove(this,force)}}]),Element}(),dom={detach:function(node){node.placeholder instanceof HTMLElement==!1&&(node.placeholder=createPlaceholder(node.data.tag||node.el.tagName)),node&&node.el&&node.el.parentNode&&node.el.parentNode.replaceChild(node.placeholder,node.el)},attach:function(node){node&&node.el&&node.placeholder&&node.placeholder.parentNode&&node.placeholder.parentNode.replaceChild(node.el,node.placeholder)},append:function(parent,child){void 0!==parent.el&&void 0!==child.el&&parent.el.appendChild(child.el)},prepend:function(parent,child){dom.insertBefore(parent,child,0)},insertBefore:function(parent,child,index){var parentEl=parent.el,childEl=child.el;void 0!==parentEl&&void 0!==childEl&&(void 0!==parentEl.childNodes[index]?parentEl.insertBefore(childEl,parentEl.childNodes[index]):parentEl.appendChild(childEl))},changePosition:function(el,index){var HTMLElement=el.el;if(HTMLElement&&HTMLElement.parentNode){var parentNode=HTMLElement.parentNode,elGroup=el.elGroup,size=elGroup.size,target=elGroup.getKeyByIndex(index)||elGroup.getLast();target!==HTMLElement&&(size-1>=index?parentNode.insertBefore(HTMLElement,target):null!==target.nextSibling?parentNode.insertBefore(HTMLElement,target.nextSibling):parentNode.appendChild(HTMLElement),el.elGroup.changeIndex(HTMLElement,index))}},text:function(node,_text2){node&&node.el&&(node.el.innerHTML=_text2)},setAttribute:function(node,prop,value){node&&node.el&&(isObject(prop)?Object.keys(prop).forEach(function(key){node.el.setAttribute(key,prop[key])}):node.el.setAttribute(prop,value))},getAttribute:function(node,prop){return node&&node.el?node.el.getAttribute(prop):void 0},removeAttribute:function(node,prop){node&&node.el&&node.el.removeAttribute(prop)},setStyle:function(node,prop,value){node&&node.el&&(isObject(prop)?Object.keys(prop).forEach(function(key){node.el.style[key]=prop[key]}):node.el.style[prop]=value)},getStyle:function(node,prop){return node&&node.el&&void 0!==node.el&&void 0!==node.el.style?node.el.style[prop]:void 0},removeStyle:function(node,prop){node&&node.el&&(node.el.style[prop]="")},addClass:function(node,className){node&&node.el&&node.el.classList.add(className)},hasClass:function(node,className){return node&&node.el?node.el.classList.contains(className):!1},removeClass:function(node,className){node&&node.el&&node.el.classList.remove(className)},val:function(node,_val2){if(node&&node.el){var el=node.el;if(void 0===_val2)return el.value;el.value=_val2}},on:function(element,ev,cb,context){for(var _len2=arguments.length,args=Array(_len2>4?_len2-4:0),_key2=4;_len2>_key2;_key2++)args[_key2-4]=arguments[_key2];var _this3=this,el=element.el,events=ev.split(" "),fn=function(e){cb.apply(context||_this3,[e,element].concat(args))};events.forEach(function(event){el.addEventListener(event,fn)});var evt={remove:function(){events.forEach(function(event){return el.removeEventListener(event,fn)});var evts=element._events;evts.splice(evts.indexOf(evt),1)}};return element._events.push(evt),evt},remove:function(el){for(;el._events.length>0;)el._events.shift().remove();el.children&&destroy(el.children),void 0!==el.elGroup&&el.elGroup["delete"](el.el),void 0!==el.el&&(el.el.remove?el.el.remove():el.el.parentNode&&el.el.parentNode.removeChild(el.el),delete el.el)},onDOMAttached:function(el){var _this4=this,handlers=[],attached=!1,_step=void 0;return void 0!==el.el&&(_step=function(){if(attached)for(;handlers.length>0;)handlers.shift()();else window.requestAnimationFrame(_step),document.body.contains(el.el)&&(attached=!0)}),{then:function(cb,context){handlers.push(cb.bind(context||_this4)),window.requestAnimationFrame(_step)}}},Element:Element};return dom}),function(root,factory){"function"==typeof define&&define.amd?define("templating/DomFragment",factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory())}(void 0,function(){function createPlaceholder(tag){var placeholder=document.createElement(tag||"div");return placeholder.setAttribute("style","display:none;"),placeholder}var DomFragment=function(){function DomFragment(_node,placeholder,childNodes,elGroup,index,obj){return _classCallCheck(this,DomFragment),Object.assign(this,{_node:_node,placeholder:placeholder,childNodes:childNodes,elGroup:elGroup,index:index,obj:obj}),this.render()}return _createClass(DomFragment,[{key:"applyAttributes",value:function(el){var attributes=this._node.data.attribs;Object.keys(attributes).forEach(function(key){el.setAttribute(key,attributes[key])})}},{key:"applyFragment",value:function(el){var node=this._node,plFragment=node.template();if(plFragment)for(;plFragment.childNodes.length>0;)el.appendChild(plFragment.childNodes[0])}},{key:"appendToBody",value:function(el){var elGroup=this.elGroup,placeholder=this.placeholder,size=elGroup.size;if(size>0){var index=void 0===this.index||this.index>size-1?size-1:this.index-1,target=elGroup.keys()[-1!==index?index:0],parentNode=target.parentNode;-1===index?parentNode.insertBefore(el,target):null!==target.nextSibling?parentNode.insertBefore(el,target.nextSibling):parentNode.appendChild(el)}else{var _parentNode=placeholder.parentNode;_parentNode&&_parentNode.replaceChild(el,placeholder)}}},{key:"render",value:function(){var placeholder=this.placeholder,node=this._node,keep=!placeholder.id&&0===this.elGroup.size,instance=node.tmpEl(keep?placeholder:!1,this.obj,this.childNodes,node),el=instance.el||createPlaceholder(node.data.tag);return keep||node.replace?node.replace||(el.innerHTML=""):this.applyAttributes(el),node.replace||this.applyFragment(el),this.appendToBody(el),instance.ready&&instance.ready(el),instance}}]),DomFragment}();return DomFragment}),function(root,factory){"function"==typeof define&&define.amd?define("templating/Decoder",["./utils/List","./dom","./DomFragment"],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory(require("./utils/List"),require("./dom"),require("./DomFragment")))}(void 0,function(List,dom,DomFragment){function isObject(obj){return obj===Object(obj)}function isArray(obj){return Array.isArray?Array.isArray(obj):"[object Array]"===toString.call(obj)}var _decoders={},Decoder=function(){function Decoder(root){_classCallCheck(this,Decoder),this._root="string"==typeof root?JSON.parse(root):root,root.children&&root.children.length>0&&(this.children=this._parseElements(root.children))}return _createClass(Decoder,null,[{key:"addDecoder",value:function(decoder){void 0===_decoders[decoder.tagName]&&(_decoders[decoder.tagName]=decoder)}}]),_createClass(Decoder,[{key:"renderFragment",value:function(template,tag){var el=document.createElement("template");return void 0===el.content&&("td"===tag?el=document.createElement("tr"):"tr"===tag&&(el=document.createElement("tbody"))),el.innerHTML=template,void 0!==el.content?el.content.firstChild:el.firstChild}},{key:"_parseElements",value:function(nodeList){var _this5=this,context={};return nodeList.forEach(function(node){var name=node.data.name,tagName=node.tagName;if(tagName){var decodedData=_decoders[tagName].decode(node);if(decodedData){var nodeParams={name:decodedData.name,data:decodedData.data,tmpEl:decodedData.tmpEl,parse:decodedData.parse,replace:decodedData.replace,id:node.id,template:function(){return _this5.renderFragment(node.template,node.data.tag)},noAttach:_decoders[tagName].noAttach||node.data.tplSet.noattach};node.children&&node.children.length>0&&(nodeParams.children=_this5._parseElements(node.children)),context[name]=nodeParams}}else name&&(context[name]={id:node.id,data:node.data,name:name})}),context}},{key:"renderTemplate",value:function(){var childNodes=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],_this6=this,obj=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],fragment=arguments[2],resp={},_runAll=[];Object.keys(childNodes).forEach(function(name){var childFragment=fragment,child=childNodes[name],children=child.children,elGroup=new List,placeholder=document.createElement(child.data.tplSet.tag||"div");if(placeholder.setAttribute("style","display:none;"),placeholder.id=child.id,elGroup.onDelete(function(key,size){0===size&&key.parentNode&&(key.parentNode.replaceChild(placeholder,key),childFragment=function(){return placeholder})}),child.template)!function(){var run=function run(force,index){var template=childFragment();force instanceof HTMLElement==!0&&(template=force);var childNodes=void 0,data=template!==force&&(isObject(force)||isArray(force))?force:obj;if(!child.noAttach||force){var _placeholder=template.querySelector("#"+child.id)||template;children&&(childNodes=_this6.renderTemplate(children,data,function(){return template}));var element=new DomFragment(child,_placeholder,childNodes,elGroup,index,data);return template=element.el,childNodes&&childNodes.runAll&&child.parse&&childNodes.runAll(),childNodes&&!element.children&&(element.children=childNodes),element.elGroup=elGroup,element.run=run,elGroup.set(element.el,element,index),element}};_runAll.push(run),resp[name]={data:child.data,run:run,elGroup:elGroup}}();else{var element=new dom.Element(childFragment().querySelector("#"+child.id),child);element.removeAttribute("id"),element.elGroup=elGroup,elGroup.set(element.el,element),resp[name]=element}});var setProp=function(obj,name,fn){Object.defineProperty(obj,name,{enumerable:!1,value:fn})},runAll=function(el){return _runAll.forEach(function(run){return run(el)}),resp};return setProp(resp,"runAll",runAll),resp}},{key:"render",value:function(obj){var fragment=this.renderFragment(this._root.template);return{fragment:fragment,children:this.renderTemplate(this.children,obj,function(){return fragment}).runAll(),templateId:this._root.templateId}}}]),Decoder}();return Decoder}),function(root,factory){"function"==typeof define&&define.amd?define("coders/component/cpDecoder",["templating/Decoder"],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory(require("./Decoder")))}(void 0,function(Decoder){var componentDecoder={tagName:"cp",decode:function(node){var data=node.data,response={name:data.name,replace:!0,tmpEl:function(placeholder,obj,children,node){var instance=new data.src(data.dataset,children,obj,node);return instance},data:data||{}};return void 0!==data.dataset.bind&&(response.bind=data.dataset.bind),response}};return Decoder&&Decoder.addDecoder(componentDecoder),componentDecoder}),function(root,factory){"function"==typeof define&&define.amd?define("coders/placeholders/plDecoder",["templating/Decoder","templating/dom"],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory(require("./Decoder"),require("./dom")))}(void 0,function(Decoder,dom){var componentDecoder={tagName:"pl",decode:function(node){var data=node.data;return{name:data.name,tmpEl:function(el,obj,children,node){return new dom.Element(el||document.createElement(data.tag),node)},parse:!0,data:data}}};return Decoder&&Decoder.addDecoder(componentDecoder),componentDecoder}),function(root,factory){"function"==typeof define&&define.amd?define("coders/databind/bdDecoder",["templating/Decoder","templating/dom"],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory(require("./Decoder"),require("./dom")))}(void 0,function(Decoder,dom){var bindingsDecoder={tagName:"bd",noAttach:!0,decode:function(node){var data=this.data=node.data,response={name:data.name,tmpEl:function(el,obj,children,node){return new dom.Element(el||document.createElement(data.tag),node)},data:data};return response}};return Decoder&&Decoder.addDecoder(bindingsDecoder),bindingsDecoder}),function(root,factory){"function"==typeof define&&define.amd?define("coders/router/routerDecoder",["templating/Decoder","templating/dom"],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory(require("./Decoder"),require("./dom")))}(void 0,function(Decoder,dom){var componentDecoder={tagName:"rt",noAttach:!0,decode:function(node){var data=node.data,response={name:data.name,tmpEl:function(el,obj,children,node){return new dom.Element(el||document.createElement(data.tag),node)},parse:!0,data:data||{}};return response}};return Decoder&&Decoder.addDecoder(componentDecoder),componentDecoder}),function(root,factory){"function"==typeof define&&define.amd?define("coders/style/styleDecoder",["templating/Decoder"],factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=factory(require("./Decoder")))}(void 0,function(Decoder){var styleDecoder={tagName:"style",decode:function(node){if(void 0===node.data.styleAttached){node.data.styleAttached=!0;var style=node.data.style,addStyle=function(style){var tag=document.createElement("style");tag.innerHTML=style,document.head.appendChild(tag)};"string"==typeof style?addStyle(style):style.then(addStyle)}}};return Decoder&&Decoder.addDecoder(styleDecoder),styleDecoder});